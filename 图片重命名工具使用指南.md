# 图片重命名工具使用指南

## 📁 必需文件

### 核心脚本（必须保留）
1. **`rename_images.py`** - 主要的图片重命名脚本（包含所有功能）
2. **`fix_ai_json.py`** - JSON文件图片引用修复脚本（备用）
3. **`fix_image_resolution.py`** - 图片分辨率后缀修复脚本（备用）

### 映射文件（自动生成）
- **`rename_report_project.txt`** - 图片重命名映射关系报告
- **`image_mapping.json`** - JSON格式的映射关系文件

## 🚀 完整使用流程

### 第一步：准备工作
```bash
# 确保在项目根目录
cd /path/to/your/project

# 备份项目（推荐）
git add -A
git commit -m "备份：图片重命名前"
```

### 第二步：执行图片重命名（推荐方式）
```bash
# 一条命令完成所有操作（推荐）
python3 rename_images.py "Zibes/Classes/Source/Assets.xcassets" --random-names --project-root "."

# 完整参数说明：
# - 第一个参数：Assets.xcassets 路径
# - --random-names：使用随机字符串命名（推荐）
# - --project-root：项目根目录，用于更新代码引用
# - --project-name：项目前缀（使用随机命名时可选）
```

### 第三步：验证结果
```bash
# 检查是否有遗漏的原始图片文件夹
find "Zibes/Classes/Source/Assets.xcassets" -name "Zibes_*" -type d

# 检查代码中是否还有原始引用
grep -r "Zibes_" "Zibes/Classes/" --include="*.m" --include="*.swift"
```

## 📋 详细参数说明

### rename_images.py 参数
```bash
python3 rename_images.py [Assets路径] [选项]

必需参数：
  Assets路径                Assets.xcassets 文件夹路径

可选参数：
  --project-name NAME      项目名称前缀（默认：project）
  --project-root PATH      项目根目录路径（用于更新代码引用）
  --random-names          使用随机字符串命名（推荐）
  --dry-run               仅预览，不实际执行
  --json-only             仅更新JSON引用，不重命名图片
  --mapping-file FILE     映射关系文件名（默认：image_mapping.json）
```

### fix_ai_json.py 参数（备用）
```bash
python3 fix_ai_json.py [选项]

必需参数（二选一）：
  --json-file PATH        单个JSON文件路径
  --project-root PATH     项目根目录（处理所有JSON文件）

可选参数：
  --mapping-file FILE     映射关系文件（默认：rename_report_project.txt）
```

### fix_image_resolution.py 参数（备用）
```bash
python3 fix_image_resolution.py [Assets路径] [选项]

必需参数：
  Assets路径              Assets.xcassets 文件夹路径

可选参数：
  --dry-run               仅预览，不实际执行
```

## 🛠️ 常见问题解决

### 问题1：图片不显示
**原因**：图片引用没有完全更新
**解决**：
```bash
# 重新运行JSON修复
python3 fix_ai_json.py --project-root "." --mapping-file "rename_report_project.txt"
```

### 问题2：图片文件缺少分辨率后缀
**原因**：图片文件没有@2x和@3x版本
**解决**：
```bash
# 运行分辨率修复脚本
python3 fix_image_resolution.py "Zibes/Classes/Source/Assets.xcassets"
```

### 问题3：发现原始文件夹残留
**原因**：重命名过程中某些文件夹没有被处理
**解决**：
```bash
# 手动检查并删除
find "Zibes/Classes/Source/Assets.xcassets" -name "Zibes_*" -type d
# 确认后手动删除这些文件夹
```

### 问题4：代码中还有原始引用
**原因**：代码文件更新不完整
**解决**：
```bash
# 重新运行主脚本的代码更新功能
python3 rename_images.py "Zibes/Classes/Source/Assets.xcassets" --json-only --project-root "."
```

## 📝 文件说明

### 生成的文件
- **`rename_report_project.txt`** - 重要！包含完整的映射关系，用于后续修复
- **`image_mapping.json`** - JSON格式的映射关系，备用

### 脚本功能说明
- **`rename_images.py`** - 主脚本，包含所有功能：
  - ✅ 文件夹重命名
  - ✅ 图片文件重命名（保持分辨率后缀）
  - ✅ Contents.json更新
  - ✅ 代码文件引用更新
  - ✅ JSON文件引用更新
  - ✅ 映射关系保存

- **`fix_ai_json.py`** - 备用JSON修复脚本：
  - ✅ JSON格式错误处理
  - ✅ 详细的错误信息显示
  - ✅ 递归JSON更新

- **`fix_image_resolution.py`** - 备用分辨率修复脚本：
  - ✅ 确保每个图片都有@2x和@3x版本
  - ✅ 修复历史遗留问题

## ⚠️ 注意事项

1. **备份重要**：执行前务必备份项目
2. **路径正确**：确保Assets.xcassets路径正确
3. **权限检查**：确保脚本有读写权限
4. **Xcode关闭**：重命名时建议关闭Xcode
5. **清理缓存**：完成后清理Xcode缓存并重新构建
6. **分辨率后缀**：脚本会自动保持@2x和@3x分辨率后缀

## 🎯 推荐工作流程

```bash
# 1. 备份项目
git add -A && git commit -m "重命名前备份"

# 2. 执行重命名（一条命令完成所有操作）
python3 rename_images.py "Zibes/Classes/Source/Assets.xcassets" --random-names --project-root "."

# 3. 验证结果
find "Zibes/Classes/Source/Assets.xcassets" -name "Zibes_*" -type d

# 4. 如果发现问题，运行备用修复脚本
python3 fix_ai_json.py --project-root "." --mapping-file "rename_report_project.txt"
python3 fix_image_resolution.py "Zibes/Classes/Source/Assets.xcassets"

# 5. 提交结果
git add -A && git commit -m "完成图片重命名"
```

## 📞 故障排除

如果遇到问题，请检查：
1. 映射文件 `rename_report_project.txt` 是否存在
2. Assets.xcassets 路径是否正确
3. 是否有足够的文件权限
4. Python版本是否为3.6+
5. 图片文件是否有正确的分辨率后缀（@2x、@3x）

## 🔧 脚本修复历史

### 已修复的问题：
1. ✅ JSON格式错误处理
2. ✅ 图片文件名称不匹配
3. ✅ 分辨率后缀问题（@2x、@3x）
4. ✅ Contents.json引用更新
5. ✅ 代码文件引用更新
6. ✅ JSON文件引用更新

---
*本文档涵盖了图片重命名工具的完整使用方法，按照此指南操作可确保图片重命名过程顺利完成。*
